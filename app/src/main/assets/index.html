<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>O Jardim das Emoções</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        /* Estilos globais */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf400;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .screen {
            display: none;
            width: 100vw;
            height: 100vh;
            max-width: 420px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0);
            position: relative;
            box-sizing: border-box;
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #10b98100;
            background-size: cover;
            background-position: center;
        }

        .screen.active {
            display: flex;
        }

        .loading-bar-container {
            position: absolute;
            bottom: 20%;
            width: 80%;
            height: 10px;
            background-color: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            left: 50%;
            transform: translateX(-50%);
        }

        .loading-bar {
            width: 0;
            height: 100%;
            background-color: #10b981;
            border-radius: 5px;
            animation: fillProgress 5s linear forwards;
        }

        @keyframes fillProgress {
            from {
                width: 0;
            }

            to {
                width: 100%;
            }
        }

        .plant {
            cursor: pointer;
            transition: transform 0.2s, filter 0.2s;
            position: absolute;
        }

        .plant:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .feedback-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 10;
        }

        .fade-in {
            animation: fadeIn 0.5s forwards;
        }

        .fade-out {
            animation: fadeOut 0.5s forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translate(-50%, -50%);
            }

            to {
                opacity: 1;
                transform: scale(1) translate(-50%, -50%);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1) translate(-50%, -50%);
            }

            to {
                opacity: 0;
                transform: scale(0.9) translate(-50%, -50%);
            }
        }

        .button-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        #mainScreen {
            background-image: url('android_asset/arquivos/background.png');
        }

        #splashScreen {
            background-image: url('android_asset/arquivos/SplashScreen.png');
        }

        #presentationScreen {
            background-image: url('android_asset/arquivos/telaApresentacao.png');
        }

        #diaryScreen {
            background-image: url('android_asset/arquivos/telaDiario.png');
        }

        #toolScreen {
            background-image: url('android_asset/arquivos/telaFerramentas.png');
        }

        #counselorScreen {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .btn {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 25vw;
            height: 15vw;
            border: none;
            cursor: pointer;
            background-color: transparent;
        }

        .mood-btn {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 18vw;
            height: 9vw;
            border: none;
            cursor: pointer;
            background-color: transparent;
        }

        .corner-btn1 {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 12vw;
            height: 12vw;
            border: none;
            cursor: pointer;
            position: absolute;
            background-color: transparent;
        }

        .corner-btn2 {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 20vw;
            height: 20vw;
            border: none;
            cursor: pointer;
            position: absolute;
            background-color: transparent;
        }

        #diarySaveFeedback {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #22c55e;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            opacity: 0;
            transition: opacity 0.5s;
            font-size: 0.875rem;
            z-index: 10;
        }

        #diarySaveFeedback.show {
            opacity: 1;
        }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDfrqME4RYWwXyR-GbtAOl6TPvGjZvC4V8",
            authDomain: "jardim-das-emocoes.firebaseapp.com",
            databaseURL: "https://jardim-das-emocoes-default-rtdb.firebaseio.com",
            projectId: "jardim-das-emocoes",
            storageBucket: "jardim-das-emocoes.firebasestorage.app",
            messagingSenderId: "18349891056",
            appId: "1:18349891056:web:659fcf4bc363d4fadd1135",
            measurementId: "G-CKWYYHY9X4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize Firebase services
        const auth = firebase.auth();
        const db = firebase.database();
    </script>
</head>

<body>

<audio id="bgMusic" loop src="arquivos/musica_de_fundo.mp3"></audio>
<audio id="plantSound" src="arquivos/som_de_interacao.mp3"></audio>
<audio id="buttonSound" src="arquivos/som_de_botao.mp3"></audio>

<div class="absolute top-10 right-30 flex space-x-2 z-50">
    <button class="p-2 rounded-full bg-green-500 text-white shadow-lg" id="audioOnBtn">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg">
            <path d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V9a1 1 0 011-1h1.586l4.293-4.293A1 1 0 0112 4v16a1 1 0 01-1.707.707L6.586 15z"
                  stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2"/>
        </svg>
    </button>
    <button class="p-2 rounded-full bg-red-500 text-white shadow-lg" id="audioOffBtn">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg">
            <path d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V9a1 1 0 011-1h1.586l4.293-4.293A1 1 0 0112 4v16a1 1 0 01-1.707.707L6.586 15z"
                  stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2"/>
            <path d="M18.885 10.985a1 1 0 01-.06.06L14 16.985" stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"/>
        </svg>
    </button>
</div>

<div class="screen flex-col justify-center items-center p-4" id="presentationScreen"
     onclick="game.startAndNavigate()">
    <div class="absolute inset-0"></div>
</div>

<div class="screen" id="mainScreen">
    <button class="corner-btn1" id="presentationBtn"
            style="background-image: url('android_asset/arquivos/BotaoApresentacao.png'); top: 4%; left: 5%;"></button>
    <button class="corner-btn2" id="diaryCornerBtn"
            style="background-image: url('android_asset/arquivos/BotaoPrivacidade.png'); top: 2%; right: 2%;"></button>

    <div class="feedback-text" id="plantFeedback"></div>

    <div class="flex items-center justify-around w-full mt-auto mb-8 absolute bottom-11 left-0">
        <button class="btn" id="diaryButton"
                style="background-image: url('android_asset/arquivos/Botao1.png');"></button>
        <button class="btn" id="toolButton"
                style="background-image: url('android_asset/arquivos/Botao2.png');"></button>
        <button class="btn" id="counselorButton"
                style="background-image: url('android_asset/arquivos/Botao3.png');"></button>
    </div>
</div>

<div class="screen flex-col justify-end items-center p-6" id="diaryScreen">
    <label for="diaryTextarea"></label><textarea
        class="absolute w-[90%] h-[52%] top-[22%] left-1/2 -translate-x-1/2 p-4 rounded-lg resize-none overflow-y-auto focus:outline-none shadow-md bg-transparent text-gray-800"
        id="diaryTextarea"
        placeholder="Escreva sobre suas emoções hoje..."></textarea>
    <div id="diarySaveFeedback">Diário salvo!</div>

    <div class="flex items-center justify-around w-full mt-4 absolute bottom-[15%]">
        <button class="mood-btn" data-mood="Feliz"
                style="background-image: url('android_asset/arquivos/feliz.png');"></button>
        <button class="mood-btn" data-mood="Triste"
                style="background-image: url('android_asset/arquivos/triste.png');"></button>
        <button class="mood-btn" data-mood="Estressado"
                style="background-image: url('android_asset/arquivos/estressado.png');"></button>
        <button class="mood-btn" data-mood="Cansado"
                style="background-image: url('android_asset/arquivos/cansado.png');"></button>
    </div>

    <button class="mt-6 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg absolute bottom-[7%] left-1/2 -translate-x-1/2"
            id="diaryBackBtn">
        Voltar
    </button>
</div>

<div class="screen flex-col justify-end items-center" id="toolScreen"
     style="background-image: url('android_asset/arquivos/telaFerramentas.png');">
    <button class="btn" data-tool="water" id="waterToolBtn"
            style="background-image: url('android_asset/arquivos/Regar.png');position: absolute; top: 37%; left: -4%; width: 39vw; height: 35vw;"></button>
    <button class="btn" data-tool="prune" id="pruneToolBtn"
            style="background-image: url('android_asset/arquivos/Podar.png');position: absolute; top: 37%; left: 30.5%; width: 39vw; height: 35vw;"></button>
    <button class="btn" data-tool="fertilize" id="fertilizeToolBtn"
            style="background-image: url('android_asset/arquivos/Adubar.png');position: absolute; top: 37%; left: 64%; width: 39vw; height: 35vw;"></button>

    <button class="absolute bottom-[7%] left-1/2 -translate-x-1/2 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg"
            id="toolBackBtn">
        Voltar
    </button>
</div>

<div class="screen flex-col justify-center items-center p-6" id="counselorScreen">
    <style>
        .halo-text {
            text-shadow:
                -1px -1px 0 #fff,
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff;
        }
    </style>
    <div class="absolute bottom-[65%] left-1/2 -translate-x-1/2 p-6 rounded-lg w-[90%] max-w-xs">
        <p class="text-black text-lg leading-relaxed halo-text" id="counselorMessage">
            Olá, como você se sente hoje?
        </p>
    </div>
    <button class="absolute bottom-[7%] left-1/2 -translate-x-1/2 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg"
            id="counselorBackBtn">
        Voltar
    </button>
</div>

<script>
    class GameManager {
        constructor() {
            this.currentTool = null;
            this.lastMood = null;
            this.conselheiroMessages = {
                "Feliz": [
                    "A alegria é como uma flor que você pode cultivar. Espalhe sementes de felicidade por onde for.",
                    "Encontre a alegria nas pequenas coisas. Ela está sempre esperando para florescer dentro de você.",
                    "Seu jardim está florescendo com luz e alegria. Continue cultivando essa beleza interior.",
                    "A felicidade é o melhor adubo para o seu jardim. O que te fez sorrir hoje?",
                    "Quando você se sente feliz, seu jardim inteiro brilha. Compartilhe sua luz.",
                    "Cada momento de alegria é uma semente que você planta para um futuro mais radiante.",
                    "Sua alegria é o sol que nutre o crescimento de todo o seu jardim.",
                    "Cultivar a felicidade não é uma tarefa, é uma recompensa. Aproveite este momento.",
                    "Lembre-se de todas as pequenas vitórias que te levaram a este estado de paz e felicidade.",
                    "Um jardim florido é o reflexo de um coração feliz. Parabéns por cuidar bem de si mesmo."
                ],
                "Triste": [
                    "É normal se sentir triste às vezes. Permita-se sentir e saiba que, como a chuva para as flores, a tristeza nutre a sua força.",
                    "Lembre-se que depois da tempestade, o sol sempre volta a brilhar. Respeite seu tempo e se cuide.",
                    "A tristeza pode ser um rio de reflexão. Deixe-o fluir para que novas sementes possam brotar.",
                    "O inverno emocional faz parte do ciclo da vida. Permita-se murchar um pouco para florescer com mais força depois.",
                    "Não tenha medo da escuridão. Às vezes, as raízes mais profundas crescem em tempos de silêncio e introspecção.",
                    "Cuide da sua dor como se fosse uma planta delicada. Regue-a com gentileza e dê tempo para ela se curar.",
                    "A tristeza é um sinal de que algo precisa de sua atenção. O que seu coração está tentando te dizer?",
                    "Pequenas sementes de esperança podem ser plantadas mesmo em solo triste. O que você pode fazer por si mesmo hoje?",
                    "Seja gentil consigo mesmo. Ninguém espera que você floresça o tempo todo.",
                    "A dor de hoje pode se transformar na força de amanhã. Dê a si mesmo o espaço para respirar."
                ],
                "Estressado": [
                    "O estresse pode ser um espinho, mas você é mais forte do que ele. Respire fundo e plante um momento de paz.",
                    "Como a água para uma planta, a calma é o que você precisa para crescer e florescer. Encontre um tempo para relaxar.",
                    "Pequenos momentos de paz são os melhores fertilizantes para um dia agitado. Permita-se ter um.",
                    "Ervas daninhas crescem rápido. Seus pensamentos ansiosos também. Podá-los com a respiração profunda é o primeiro passo.",
                    "A pressa é a inimiga da jardinagem. Desacelere e foque em uma coisa de cada vez. A colheita será mais gratificante.",
                    "Não se sinta sobrecarregado pelas ervas daninhas. Apenas comece a podar uma por uma.",
                    "O vento forte do estresse pode balançar suas plantas. Segure-se firme, você é a raiz mais forte do seu jardim.",
                    "Lembre-se de que a perfeição não é um requisito para florescer. Relaxe um pouco e as coisas se ajustarão.",
                    "Seu jardim precisa de tranquilidade para florescer. Encontre um momento só seu para restaurar a paz interior.",
                    "O estresse é apenas um visitante. Não o deixe se instalar. Respire fundo e convide a calma para ficar."
                ],
                "Cansado": [
                    "O cansaço é um sinal de que você se dedicou. Descanse, recarregue as energias e volte a florescer amanhã.",
                    "Dê a si mesmo a chance de descansar. Você é um jardim que precisa de cuidado e tranquilidade para continuar a crescer.",
                    "A pausa não é fraqueza, mas sim o solo fértil de onde a resiliência irá brotar.",
                    "As plantas precisam de descanso para crescer. Seu corpo e sua mente também. Não se culpe por precisar de uma pausa.",
                    "Se sentir exausto, é porque você se esforçou. Celebre seu esforço e permita-se um descanso merecido.",
                    "Um jardim florido não pode existir sem a terra que o nutre. Volte à sua base, descanse e se nutra.",
                    "O cansaço é um lembrete de que você é humano. Seja gentil consigo e priorize sua paz.",
                    "Dormir é como regar o seu jardim interior. Quanto mais você descansa, mais suas emoções podem florescer.",
                    "Um momento de silêncio e um bom descanso podem fazer maravilhas. Dê esse presente a si mesmo.",
                    "Seja a terra que permite que as sementes descansem e se preparem para brotar."
                ]
            };
            this.screens = document.querySelectorAll('.screen');
            this.counselorBackgrounds = [];
            for (let i = 1; i <= 15; i++) {
                this.counselorBackgrounds.push(`android_asset/arquivos/Conselheiro${i}.jpg`);
            }
            this.bgMusic = document.getElementById('bgMusic');
            this.plantSound = document.getElementById('plantSound');
            this.buttonSound = document.getElementById('som_de_botao.mp3');
            this.isMusicReady = false;
            this.deviceId = null;

            this.plants = [
                { id: 'plant1', name: 'Planta1', src: 'android_asset/arquivos/Planta1.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta1.png', style: 'top: 70%; left: 4%; width: 15vw; height: 15vw;' },
                { id: 'plant2', name: 'Planta2', src: 'android_asset/arquivos/Planta2.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta2.png', style: 'top: 63%; left: 64%; width: 18vw; height: 18vw;' },
                { id: 'plant3', name: 'Planta3', src: 'android_asset/arquivos/Planta3.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta3.png', style: 'top: 56%; left: 25%; width: 13vw; height: 13vw;' },
                { id: 'plant4', name: 'Planta4', src: 'android_asset/arquivos/Planta4.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta4.png', style: 'top: 58%; left: 10%; width: 13vw; height: 13vw;' },
                { id: 'plant5', name: 'Planta5', src: 'android_asset/arquivos/Planta5.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta5.png', style: 'top: 73%; left: 35%; width: 15vw; height: 15vw;' },
                { id: 'plant6', name: 'Planta6', src: 'android_asset/arquivos/Planta6.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta6.png', style: 'top: 63%; left: 3%; width: 15vw; height: 15vw;' },
                { id: 'plant7', name: 'Planta7', src: 'android_asset/arquivos/Planta7.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta7.png', style: 'top: 53%; left: 70%; width: 23vw; height: 23vw;' },
                { id: 'plant8', name: 'Planta8', src: 'android_asset/arquivos/Planta8.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta8.png', style: 'top: 66%; left: 83%; width: 15vw; height: 15vw;' },
                { id: 'plant9', name: 'Planta9', src: 'android_asset/arquivos/Planta9.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta9.png', style: 'top: 68%; left: 23%; width: 10vw; height: 10vw;' },
                { id: 'plant10', name: 'Planta10', src: 'android_asset/arquivos/Planta10.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta10.png', style: 'top: 69%; left: 48%; width: 10vw; height: 10vw;' },
                { id: 'plant11', name: 'Planta11', src: 'android_asset/arquivos/Planta11.png', drySrc: 'android_asset/arquivos/PlantasSecas/Planta11.png', style: 'top: 74%; left: 70%; width: 10vw; height: 10vw;' }
            ];
        }

        // Função para pegar o ID da URL e autenticar o usuário
        getDeviceIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            this.deviceId = urlParams.get('deviceId');
            if (this.deviceId) {
                console.log("Device ID recebido da URL:", this.deviceId);
                this.authenticateWithDeviceId();
            } else {
                console.error("Device ID não encontrado na URL.");
            }
        }

        async authenticateWithDeviceId() {
            if (!this.deviceId) {
                console.error("GameManager.authenticateWithDeviceId() chamado sem deviceId definido. Isso não deveria ocorrer.");
                return;
            }

            console.log("Usuário autenticado com sucesso. UID (ID do dispositivo): " + this.deviceId);

            const userRef = db.ref('users/' + this.deviceId);

            userRef.once('value').then(snapshot => {
                const userData = snapshot.val();
                if (userData) {
                    this.navigate('mainScreen');
                    this.bgMusic.play().catch(e => console.error("Falha ao tocar música:", e));
                    setInterval(() => {
                        this.checkAndDryPlants();
                    }, 30000);
                } else {
                    userRef.set({ createdAt: firebase.database.ServerValue.TIMESTAMP }).then(() => {
                        console.log("Novo usuário criado no banco de dados.");
                        this.navigate('presentationScreen');
                    });
                }
            }).catch(error => {
                console.error("Erro ao verificar usuário no Firebase:", error);
                alert("Erro ao carregar dados do usuário. Tente novamente.");
            });
        }

        loadDiary() {
            if (!this.deviceId) {
                console.error("ID do dispositivo não encontrado. Não foi possível carregar o diário.");
                alert("Não foi possível carregar o diário. Tente reiniciar o aplicativo.");
                return;
            }

            const diaryRef = db.ref('diaries/' + this.deviceId);
            diaryRef.once('value', (snapshot) => {
                const diaryTextarea = document.getElementById('diaryTextarea');
                const data = snapshot.val();
                if (data) {
                    diaryTextarea.value = data.entry || "";
                } else {
                    diaryTextarea.value = "";
                }
                this.navigate('diaryScreen');
            });
        }

        saveDiary() {
            if (!this.deviceId) {
                console.error("ID do dispositivo não encontrado. Não foi possível salvar o diário.");
                return;
            }

            const diaryTextarea = document.getElementById('diaryTextarea');
            const textToSave = diaryTextarea.value;
            const diaryRef = db.ref('diaries/' + this.deviceId);
            const feedbackEl = document.getElementById('diarySaveFeedback');

            diaryRef.set({
                entry: textToSave,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                console.log("Diário salvo com sucesso!");
                feedbackEl.textContent = "Diário salvo!";
                feedbackEl.classList.add('show');
                setTimeout(() => {
                    feedbackEl.classList.remove('show');
                }, 2000);
            }).catch((error) => {
                console.error("Erro ao salvar o diário:", error);
                feedbackEl.textContent = "Erro ao salvar!";
                feedbackEl.style.backgroundColor = '#ef4444';
                feedbackEl.classList.add('show');
                setTimeout(() => {
                    feedbackEl.classList.remove('show');
                }, 2000);
            });
        }

        setRandomCounselorBackground() {
            const randomIndex = Math.floor(Math.random() * this.counselorBackgrounds.length);
            const randomBackground = this.counselorBackgrounds[randomIndex];
            document.getElementById('counselorScreen').style.backgroundImage = `url('${randomBackground}')`;
        }

        navigate(nextScreenId) {
            this.screens.forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(nextScreenId).classList.add('active');
            this.buttonSound.play();
        }

        selectTool(tool) {
            this.currentTool = tool;
            this.navigate('mainScreen');
        }

        interactWithPlant(event) {
            if (!this.currentTool) {
                console.log("Nenhuma ferramenta selecionada.");
                const feedbackEl = document.getElementById('plantFeedback');
                feedbackEl.textContent = "Selecione uma ferramenta primeiro!";
                feedbackEl.classList.add('fade-in');
                setTimeout(() => {
                    feedbackEl.classList.remove('fade-in');
                    feedbackEl.classList.add('fade-out');
                }, 1500);
                return;
            }

            const feedbackEl = document.getElementById('plantFeedback');
            let message = '';

            feedbackEl.classList.remove('fade-in', 'fade-out');

            const plantElement = event.target;
            const plantId = plantElement.id;
            const plantData = this.plants.find(p => p.id === plantId);

            if (plantData.isDry && this.currentTool === 'water') {
                plantElement.src = plantData.src;
                plantData.isDry = false;
                message = "A planta está saudável novamente!";
            } else if (!plantData.isDry && this.currentTool === 'water') {
                message = "A planta já está regada!";
            } else if (this.currentTool === 'prune') {
                message = "A planta foi podada!";
            } else if (this.currentTool === 'fertilize') {
                message = "A planta foi adubada!";
            } else {
                message = "Ferramenta incorreta para esta ação!";
            }

            feedbackEl.textContent = message;
            feedbackEl.classList.add('fade-in');
            this.plantSound.play();

            setTimeout(() => {
                feedbackEl.classList.remove('fade-in');
                feedbackEl.classList.add('fade-out');
            }, 1500);

            this.currentTool = null;
        }

        setMood(mood) {
            this.lastMood = mood;
            this.openCounselorScreen();
        }

        openCounselorScreen() {
            this.setRandomCounselorBackground();
            let message = "Olá, como você se sente hoje?";
            if (this.lastMood && this.conselheiroMessages[this.lastMood]) {
                const messages = this.conselheiroMessages[this.lastMood];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                message = randomMessage;
            } else {
                const allMessages = Object.values(this.conselheiroMessages).flat();
                message = allMessages[Math.floor(Math.random() * allMessages.length)];
            }
            document.getElementById('counselorMessage').textContent = message;
            this.navigate('counselorScreen');
        }

        checkAndDryPlants() {
            const dryPlantsCount = this.plants.filter(p => p.isDry).length;
            if (dryPlantsCount < 3) {
                const healthyPlants = this.plants.filter(p => !p.isDry);
                const plantsToDry = [];
                while (plantsToDry.length < (3 - dryPlantsCount) && healthyPlants.length > 0) {
                    const randomIndex = Math.floor(Math.random() * healthyPlants.length);
                    plantsToDry.push(healthyPlants.splice(randomIndex, 1)[0]);
                }

                plantsToDry.forEach(plant => {
                    const plantElement = document.getElementById(plant.id);
                    if (plantElement) {
                        plantElement.src = plant.drySrc;
                        plant.isDry = true
                    }
                });
            }
        }

        startAndNavigate() {
            this.navigate('mainScreen');
            this.bgMusic.play().catch(e => console.error("Falha ao tocar música:", e));
        }
    }

    const game = new GameManager();
    const diaryTextarea = document.getElementById('diaryTextarea');
    const mainScreen = document.getElementById('mainScreen');
    const audioOnBtn = document.getElementById('audioOnBtn');
    const audioOffBtn = document.getElementById('audioOffBtn');

    game.bgMusic.addEventListener('canplaythrough', () => {
        game.isMusicReady = true;
    });

    audioOnBtn.addEventListener('click', () => {
        game.bgMusic.play().catch(e => console.error("Falha ao tocar música:", e));
    });

    audioOffBtn.addEventListener('click', () => {
        game.bgMusic.pause();
    });

    document.addEventListener('DOMContentLoaded', () => {
        game.plants.forEach(plant => {
            const img = document.createElement('img');
            img.id = plant.id;
            img.src = plant.src;
            img.className = 'plant';
            img.style = plant.style;
            mainScreen.appendChild(img);
        });

        game.getDeviceIdFromUrl();

        diaryTextarea.addEventListener('input', () => {
            game.saveDiary();
        });

        document.getElementById('presentationBtn').addEventListener('click', () => {
            game.navigate('presentationScreen');
        });
        document.getElementById('diaryCornerBtn').addEventListener('click', () => {
            game.buttonSound.play();
            window.location.href = 'privacidade.html';
        });
        document.getElementById('diaryButton').addEventListener('click', () => {
            game.loadDiary();
        });
        document.getElementById('toolButton').addEventListener('click', () => {
            game.navigate('toolScreen');
        });

        document.getElementById('counselorButton').addEventListener('click', () => {
            game.openCounselorScreen();
        });

        document.getElementById('waterToolBtn').addEventListener('click', (e) => {
            game.selectTool(e.currentTarget.dataset.tool);
        });

        document.getElementById('pruneToolBtn').addEventListener('click', (e) => {
            game.selectTool(e.currentTarget.dataset.tool);
        });

        document.getElementById('fertilizeToolBtn').addEventListener('click', (e) => {
            game.selectTool(e.currentTarget.dataset.tool);
        });

        document.getElementById('toolBackBtn').addEventListener('click', () => {
            game.navigate('mainScreen');
        });

        document.getElementById('diaryBackBtn').addEventListener('click', () => {
            game.saveDiary();
            game.navigate('mainScreen');
        });

        document.getElementById('counselorBackBtn').addEventListener('click', () => {
            game.navigate('mainScreen');
        });

        mainScreen.addEventListener('click', (e) => {
            if (e.target.classList.contains('plant')) {
                game.interactWithPlant(e);
            }
        });

        document.querySelectorAll('.mood-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                game.setMood(e.currentTarget.dataset.mood);
            });
        });
        const urlHash = window.location.hash;
        if (urlHash === '#mainScreen') {
            game.navigate('mainScreen');
        }
    });
</script>
</body>

</html>